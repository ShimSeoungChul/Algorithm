# 03 충돌 해결
- 해시 테이블 내의 한 주소를 놓고 두 개 이상의 원소가 자리를 다투는 것을 충돌이라한다.
- 충돌 해결에는 크게 두 가지 방법이 있다. <br />
첫 번째는 체이닝이며, 이것은 해시 테이블의 각 주소가 리스트의 해더 역할을 하고, 여기에 해당 주소로 들어오는 원소들이 연결 리스트로 매달린다. <br />
두 번째는 개방 주소 방법이며, 체이닝이 추가 공간을 사용하는 것과 달리 해시 테이블 내에서 충돌을 해결한다. <br />
즉, 충돌이 일어나면 원소가 원래 들어갈 자리가 아니더라도 테이블의 다른 자리를 찾아 들어간다. 

## 1 체이닝
- 체이닝은 같은 주소로 해싱되는 원소를 모두 하나의 연결 리스트에 매달아 관리한다. 
- 해시 테이블 크기가 m이면 최대 m개의 연결 리스트가 존재할 수 있다.

<img width="250" alt="체이닝을이용한충돌해결" src="https://user-images.githubusercontent.com/40673012/95144346-629e1600-07b3-11eb-859f-91f27669f512.png">

- 임의의 원소를 연결 리스트에 삽입할 때는 해당 리스트의 맨 앞에 삽입한다.

### 알고리즘 7-1 체이닝을 이용하는 해시 테이블에서 작업
```
//T:해시 테이블. x: 삽입 원소
chainedHashInsert(T[],x){
    리스트 T[h(x)]의 맨 앞에 x를 삽입;
}

//T:해시 테이블. x: 검색 원소
chainedHashSearch(T[],x){
    리스트 T[h(x)]에서 x값을 가지는 원소를 검색;
}

//T:해시 테이블. x: 삭제 원소
chainedHashDelete(T[],x){
    리스트 T[h(x)]에서 x의 노드를 삭제;
}
```

## 2 개방 주소 방법

### 2.1 선형 조사

- what? : 충돌이 일어난 바로 뒷자리로 이동하는 방법이다. <br />
(엄밀하게는 충돌이 일어난 자리에서 `i에 관한 일차 함수의 보폭으로 점프`를 하는 것이나 흔히 일차 함수의 대표로 그냥 i를 쓴다.)<br />
이렇게 하면 `hᵢ(x)`는 `h(x)에서 i만큼 떨어진 자리`가 된다. <br />

- 테이블의 경계를 넘어갈 경우 맨 앞으로 간다.

<img width="350" alt="선형조사의예" src="https://user-images.githubusercontent.com/40673012/95144361-6f226e80-07b3-11eb-87ff-fa739f4f3adc.png">

- 정리하면 선형 조사 방법의 i번째 해시 함수를 다음과 같다. <br />
`hᵢ(x) = ((h(x)+i) mod m`   `i = 0,1,2` <br />

- 선형 조사는 `특정 영역에 원소가 몰릴 때` 치명적으로 `성능이 떨어진다`. <br />
이런 현상을 `1차 군집(Primary Clustering)`이라 한다. <br />


-  아래 그림에서 주소 2부터 6 사이로 해싱되는 원소들은 해당 주소에서 차례로 훑어 <br />
주소 7에 이르러야 하므로 조사 횟수가 늘어난다.  <br />
조사 횟수는 주소 6으로 해싱되면 두번, 주소 5로 해싱되면 세번 ..., 주소 2로 해싱되면 여섯 번이 된다.<br />

- `영역이 커질수록` 해당 영역으로 해싱될 확률이 커지므로 군집이 심하지 않은 영역에 비해 `영역의 크기가 빨리 커진다`. <br />

- `두 개의 군집된 영역이 붙으면` 영역은 갑자기 커지기도 한다.

<img width="203" alt="1차군집의예" src="https://user-images.githubusercontent.com/40673012/95144389-82cdd500-07b3-11eb-8aff-8d1e414ad56e.png">

### 2.2 이차원 조사
- What? : 바로 뒷자리를 보는 대신 보폭을 `이차 함수`로 넗혀가며 보는 방식이다. <br />
예를 들어 i번째 해시 함수를 h(x)에서 i²만큼 떨어진 자리로 삼을 수 있다. <br />
즉, h(x), h(x)+1, h(x)+4, h(x)+9, h(x)+16, ... 과 같이 볼 수 있다. <br />

- 이차원 조사 방법의 i번째 해시 함수는 다음과 같은 모양이 된다.<br />
`hᵢ(x) = (h(x)+c₁i²+c₂i) mod m`  ` i = 0,1,2` <br />

- Why? 장점: 이렇게 하면 특정 영역에 원소가 몰려도 그 영역을 빨리 벗어날 수 있다. <br />
- 단점:  여러 개의 원소가 동일한 초기 해시 함수 값을 갖으면, 모두 같은 순서로 조사해야 하므로 비효율적이 된다. <br />
이런 현상을 `2차 군집(Secondary Clustering)`이라 한다.

-  그림 7-7은 `2차 군집의 예`이며, 해시 함수로는 hᵢ(x) = (h(x)+i²) mod m을 사용했다. 

<img width="275" alt="2차군집의예" src="https://user-images.githubusercontent.com/40673012/95144414-9416e180-07b3-11eb-9924-c56968636da5.png">


### 2.3 더블 해싱
- What?: 서로 다른 두 개의 해시 함수를 사용하여, 첫 번째 함수로 해싱하여 정해진 자리에서 충돌이 생기면, <br />
두 번째 해시 함수 값만큼씩 점프하는 방식이다.

- 더블 해싱에서 i번째 해시 함수는 다음과 같다.<br />
`hᵢ(x) = (h(x)+i*f(x)) mod m`  ` i = 0,1,2` <br />

- 두 원소의 첫 번째 해시 값이 같더라도 두 번째 함수 값 까지 같을 확률은 매우 작기 때문에 <br />
`서로 다른 보폭으로 점프`를 하므로 2차 군집 문제가 발생하지 않는다.<br />

- 두 개의 해시 함수를 정할 때 `권장하는 방법`은 h(x) = x mod m으로  잡고, <br />
m보다 조금 작은 `소수 m'`에 대하여 f(x) =  1 + (x mod m')으로 잡는 것이다.

<img width="256" alt="2차군집의해방된예" src="https://user-images.githubusercontent.com/40673012/95144454-a7c24800-07b3-11eb-85f6-be302830716b.png">


#### 주의사항
- 두 번째 해시 함수 값 f(x)가 해시 테이블 크기 m과 `서로 소인 값`이어야 한다. <br />
f(x)와 m이 1보다 큰 `최소공약수 d`를 가지면 x의 자리를 찾기 위해 해시 테이블 전체 중에 <br />
기껏해야 `1/d`밖에 보지 못하게 된다. <br />

- 개방 주소 방법은 테이블에 주어진 공간만 사용할 수 있으므로 `적재율`이 1을 넘을 수는 없다.
- 적재율이 높아지면 `효율`이 급격히 떨어지므로 적당한 `임계점`을 설정한 후 그것을 넘으면 <br />
`해시 테이블의 크기`를 대략 두 배로 키우고 모든 원소를 다시 `해싱`하는 것이 일반적이다.


#### 알고리즘 7-2 개방 주소 방법
```
hashInsert(T[],x){
    i <- 0;
    repeat{
        j <- hᵢ();
        if(T[j] = NIL)
            then {T[j]<-x;return f;}
            else i++;
    }until (i=m)
    error "테이블 오버플로";
}

hashSearch(T[],x)
{
    i<-0;
    repeat{
        j <- hᵢ(x);
        if(T[j]=x)
            then return f;
            else i++;
    }until (T[j]=NIL, or i=m)
    return NIL;
}
```


#### 개방 주소 방법의 원소 삭제

- 원소를 삭제할 때 원래는 원소가 있던 자리였음을 표시하자. <br />
예를 들어 아래 그림 처럼 DELETED라는 `상수`를 저장하면 된다. <br />
그리고 삽입 과정에서 DELETED를 만나면 그 자리에 원소를 넣으면 된다.

<img width="377" alt="해시테이블의자료삭제" src="https://user-images.githubusercontent.com/40673012/95144476-b90b5480-07b3-11eb-954c-04e79f480131.png">

